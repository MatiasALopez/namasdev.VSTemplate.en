@using namasdev.Web.Helpers;
@using MyApp.Entities.Metadata;
@using MyApp.Web.Portal.ViewModels.Users;
@using MyApp.Web.Portal.Controllers;
@model UserViewModel
@{
    ViewBag.Title = $"{Model.PageMode} {UserMetadata.NAME}";

    var controlsIds = new
    {
        Form = $"frm{UserMetadata.NAME}"
    };
    var actionNames = new
    {
        Active = nameof(UsersController.Active),
        Edit = nameof(UsersController.Edit),
        UnsetDeleted = nameof(UsersController.UnsetDeleted),
    };
    var actionDisplayNames = new
    {
        ReactivateUser = "Reactivate user",
    };
}
<h2 class="my-3">@ViewBag.Title</h2>
<form id="@controlsIds.Form" action="@Url.Action()" method="post" class="mt-3">
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(excludePropertyErrors: true)
    @Html.MessageSuccess()
    @Html.MessageError()
    @Html.HiddenFor(m => m.Id)
    @Html.HiddenFor(m => m.PageMode)
    <div class="form-row">
        <div class="form-group col-lg-5 col-md-6">
            @Html.LabelFor(m => m.FirstName, new { @class = "required" })
            @Html.TextBoxFor(m => m.FirstName, new { @class = "form-control form-control-required", maxlength = UserMetadata.Properties.FirstName.LENGTH_MAX })
            @Html.ValidationMessageFor(m => m.FirstName)
        </div>
        <div class="form-group col-lg-5 col-md-6">
            @Html.LabelFor(m => m.LastName, new { @class = "required" })
            @Html.TextBoxFor(m => m.LastName, new { @class = "form-control form-control-required", maxlength = UserMetadata.Properties.LastName.LENGTH_MAX })
            @Html.ValidationMessageFor(m => m.LastName)
        </div>
    </div>
    <div class="form-row">
        <div class="form-group col-lg-5 col-md-6">
            @Html.LabelFor(m => m.Email, new { @class = "required" })
            @Html.TextBoxFor(m => m.Email, new { @class = "form-control form-control-required", maxlength = UserMetadata.Properties.Email.LENGTH_MAX })
            @Html.ValidationMessageFor(m => m.Email)
        </div>
        <div class="form-group col-lg-5 col-md-6">
            @Html.LabelFor(m => m.Role, new { @class = "required" })
            @Html.DropDownListFor(m => m.Role, Model.RolesSelectList, "", new { @class = "form-control form-control-required" })
            @Html.ValidationMessageFor(m => m.Role)
        </div>
    </div>
    <button type="submit" class="btn btn-primary" data-toggle-state-container="#@controlsIds.Form">Save</button>
    <a href="@Url.Action(nameof(UsersController.Active))" class="btn btn-secondary">Back</a>
</form>
@section bodyScripts {
    <script type="text/javascript">
        $(function () {
            MyApp.setActiveMenuOption('@UserMetadata.NAME_PLURAL.ToLower()');

            @if (!String.IsNullOrWhiteSpace(Model.UnsetDeletedUserId)) { <text>
            var options = {
                confirm: true,
                confirmTitle: 'Pre-existent @UserMetadata.LABEL',
                confirmMessage: '@UserMetadata.Messages.ADD_ERROR<br />\
                @UserMetadata.Properties.Email.LABEL is already being used by another @UserMetadata.LABEL set as deleted.<br />\
                In order to reactivate the deleted @UserMetadata.LABEL use the "@actionDisplayNames.ReactivateUser" button.<br />\
                Otherwise, please enter a different @UserMetadata.Properties.Email.LABEL.',
                confirmButtons: {
                    confirm: {
                        label: '@actionDisplayNames.ReactivateUser',
                        className: 'btn-primary',
                    }
                }
            };

            MyApp.postJson(
                '@Url.Action(actionNames.UnsetDeleted)/@Model.UnsetDeletedUserId',
                nmd.ui.forms.createDataWithAntiForgeryToken('#@controlsIds.Form'),
                function (response) {
                    if (response.success) {
                        nmd.ui.controls.showSuccessModal(
                            '@UserMetadata.LABEL reactivated successfully. To review/edit the @UserMetadata.LABEL\'s data click <a href="@Url.Action(actionNames.Edit)/@Model.UnsetDeletedUserId">here</a>.',
                            function () {
                                window.location = '@Url.Action(actionNames.Active)';
                            });
                    }
                    else {
                        MyApp.showErrorModal(response.message);
                    }
                },
                options
            );
            </text>}
        });
    </script>
}
